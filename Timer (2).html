<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>PS3 Timer</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: block;
      width: 350px;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    }

    #pasdagi {
      position: fixed;
      background: orange;
      top: 20px;
      left: 20px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      z-index: 10000;
    }

    /* === HISOBOT TAB === */
    #logTab {
      display: none; /* Bosilganda ko‚Äòrsatiladi */
      position: fixed;
      width: 350px;
      inset: 0;
      background: #f5f7fb;
      padding: 16px;
      overflow-y: auto;
      z-index: 9999;
      font-family: Arial, sans-serif;
    }

    #logTab h2 {
      margin-top: 0;
      color: #0d47a1;
      text-align: center;
    }

    #logTab button {
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      margin: 5px 4px;
      font-size: 16px;
      cursor: pointer;
    }

    #logTab button:first-of-type {
      background: #607d8b;
      color: #fff;
    }

    #logTab button:last-of-type {
      background: #d32f2f;
      color: #fff;
    }

    #logList {
      list-style: none;
      padding: 0;
      margin-top: 15px;
    }

    #logList li {
      background: #fff;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      font-size: 14px;
      line-height: 1.4;
    }

    @media (max-width: 600px) {
      #logTab {
        padding: 10px;
      }
      #logList li {
        font-size: 13px;
      }
    }

    h1 {
      text-align: center;
      color: #0d47a1;
      font-size: 45px;
      font-weight: 800;
      margin: 20px 0;
    }

    .ps {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .timer {
      background: #fff;
      padding: 15px;
      width: 260px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(13,71,161,0.15);
      border-top: 6px solid #1976d2;
    }

    .timer h3 {
      color: #1565c0;
      margin-bottom: 10px;
    }

    .time {
      font-weight: bold;
      font-size: 18px;
      color: #0d47a1;
    }

    .cost {
      font-weight: bold;
      color: #1a237e;
    }

    button {
      width: 100%;
      margin-top: 6px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }

    .tarif-btn {
      background: #e3f2fd;
      color: #0d47a1;
    }

    .tarif-btn.active {
      background: #1976d2;
      color: #fff;
    }

    .start-btn { background: #1976d2; color: #fff; }
    .stop-btn  { background: #21a7eb; color: #fff; }
    .reset-btn { background: red; color: #fff; }

    .start-time {
      margin-top: 8px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>

<body>

<h1>PS 3</h1>

<!-- HISOBOTLAR TAB -->
<div id="logTab">
  <h2>üìë Hisobotlar</h2>
  <button onclick="closeLogTab()">‚ùå Yopish</button>
  <button onclick="clearLogs()" style="background:red;color:white;">üóë Tozalash</button>
  <ul id="logList"></ul>
</div>

<!-- PS TIMERLAR -->
<div class="ps">
  <!-- 1-Stol -->
  <div class="timer">
    <h3>1-Stol</h3>
    <p>Vaqt: <span class="time">00:00:00:000</span></p>
    <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
    <p>Summa: <span class="cost">0</span> so'm</p>

    <button class="tarif-btn" onclick="setTarif(this,15000)">2 ta pult</button>
    <button class="tarif-btn" onclick="setTarif(this,18000)">3 ta pult</button>
    <button class="tarif-btn" onclick="setTarif(this,20000)">4 ta pult</button>

    <button class="start-btn" onclick="startTimer(this)">Start</button>
    <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
    <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
  </div>

  <!-- 2-Stol -->
  <div class="timer">
    <h3>2-Stol</h3>
    <p>Vaqt: <span class="time">00:00:00:000</span></p>
    <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
    <p>Summa: <span class="cost">0</span> so'm</p>

    <button class="tarif-btn" onclick="setTarif(this,15000)">2 ta pult</button>
    <button class="tarif-btn" onclick="setTarif(this,18000)">3 ta pult</button>
    <button class="tarif-btn" onclick="setTarif(this,20000)">4 ta pult</button>

    <button class="start-btn" onclick="startTimer(this)">Start</button>
    <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
    <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
  </div>

  <!-- 3-Stol -->
  <div class="timer">
    <h3>3-Stol</h3>
    <p>Vaqt: <span class="time">00:00:00:000</span></p>
    <p>Tarif: <span class="current-tarif">Tanlanmagan</span></p>
    <p>Summa: <span class="cost">0</span> so'm</p>

    <button class="tarif-btn" onclick="setTarif(this,15000)">2 ta pult</button>
    <button class="tarif-btn" onclick="setTarif(this,18000)">3 ta pult</button>
    <button class="tarif-btn" onclick="setTarif(this,20000)">4 ta pult</button>

    <button class="start-btn" onclick="startTimer(this)">Start</button>
    <button class="stop-btn" onclick="stopTimer(this)">Stop</button>
    <button class="reset-btn" onclick="resetTimer(this)">Reset</button>
  </div>
</div>

<!-- OPEN LOG BUTTON -->
<div id="pasdagi" onclick="openLogTab()">üìë</div>

<script>
/*********************************
 * GLOBAL STORAGE
 *********************************/
const TIMER_LOG_KEY = "ps_timer_logs";
const timers = new Map();

/*********************************
 * LOCAL STORAGE
 *********************************/
function getLogs() {
  try { return JSON.parse(localStorage.getItem(TIMER_LOG_KEY)) || []; } 
  catch { return []; }
}
function saveLogs(logs) { localStorage.setItem(TIMER_LOG_KEY, JSON.stringify(logs)); }
function addLog(log) { const logs = getLogs(); logs.push(log); saveLogs(logs); }

/*********************************
 * HISOBOT TAB
 *********************************/
function openLogTab() {
  const tab = document.getElementById("logTab");
  if (tab) tab.style.display = "block";
  renderLogs();
}
function closeLogTab() { document.getElementById("logTab").style.display = "none"; }
function clearLogs() {
  if (!confirm("Barcha hisobotlar o‚Äòchsinmi?")) return;
  localStorage.removeItem(TIMER_LOG_KEY);
  renderLogs();
}
function renderLogs() {
  const list = document.getElementById("logList");
  list.innerHTML = "";
  getLogs().forEach((log,i)=>{
    const li = document.createElement("li");
    li.textContent = `${i+1}) ${log.date} | ${log.duration} | ${log.tarif} | ${log.cost} so'm | ${log.action}`;
    list.appendChild(li);
  });
}

/*********************************
 * TARIF TANLASH
 *********************************/
function setTarif(btn, rate) {
  const box = btn.closest(".timer");
  if(!box) return;
  box.rate = rate;
  box.tarifName = btn.innerText;
  box.querySelector(".current-tarif").innerText = btn.innerText;
  box.querySelectorAll(".tarif-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

/*********************************
 * TIMER
 *********************************/
function startTimer(btn){
  const box = btn.closest(".timer");
  if(!box || !box.rate){ alert("Avval tarif tanlang!"); return; }
  if(timers.has(box)) return;

  box.startTime = Date.now();
  box.offset = box.offset || 0;

  const interval = setInterval(()=>{
    const elapsed = Date.now()-box.startTime + box.offset;
    updateUI(box, elapsed);
  },50);
  timers.set(box, interval);
}

function stopTimer(btn){
  const box = btn.closest(".timer");
  if(!box || !timers.has(box)) return;
  clearInterval(timers.get(box));
  timers.delete(box);
  box.offset += Date.now() - box.startTime;
  box.startTime = null;
  saveTimerLog(box,"STOP");
}

function resetTimer(btn){
  const box = btn.closest(".timer");
  if(!box) return;
  if(timers.has(box)){ clearInterval(timers.get(box)); timers.delete(box); }
  saveTimerLog(box,"RESET");
  box.startTime = null;
  box.offset = 0;
  box.querySelector(".time").innerText="00:00:00:000";
  box.querySelector(".cost").innerText="0";
}

function updateUI(box, elapsed){
  const h=Math.floor(elapsed/3600000);
  const m=Math.floor((elapsed%3600000)/60000);
  const s=Math.floor((elapsed%60000)/1000);
  const ms=elapsed%1000;
  box.querySelector(".time").innerText=
    `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(ms).padStart(3,"0")}`;
  const cost = Math.round(elapsed/3600000*(box.rate||0));
  box.querySelector(".cost").innerText=cost.toLocaleString();
}

function saveTimerLog(box,action){
  const now = new Date();
  const date =
    `${String(now.getDate()).padStart(2,"0")}.`+
    `${String(now.getMonth()+1).padStart(2,"0")}.`+
    `${now.getFullYear()} ${now.toLocaleTimeString()}`;
  const totalMs = box.offset || 0;
  const h=Math.floor(totalMs/3600000);
  const m=Math.floor((totalMs%3600000)/60000);
  const s=Math.floor((totalMs%60000)/1000);
  const ms = totalMs%1000;
  const cost = Math.round(totalMs/3600000*(box.rate||0));
  addLog({
    date,
    duration:`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(ms).padStart(3,"0")}`,
    tarif:box.tarifName||"Tarif tanlanmagan",
    cost:cost.toLocaleString(),
    action
  });
}
</script>
</body>
</html>
